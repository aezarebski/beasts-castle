#+title: Cogsworth
#+Time-stamp: <Last modified: 2022-11-01 11:24:03>
#+startup: overview
#+OPTIONS: toc:2

#+begin_src xml :tangle cogsworth.xml
<?xml version="1.0"?>
<project name="cogsworth" basedir=".">
  <description>
         _________________________________________________________________________
        |                                                                         |
        |          __________  ____________       ______  ____  ________  __      |
        |         / ____/ __ \/ ____/ ___/ |     / / __ \/ __ \/_  __/ / / /      |
        |        / /   / / / / / __ \__ \| | /| / / / / / /_/ / / / / /_/ /       |
        |       / /___/ /_/ / /_/ /___/ /| |/ |/ / /_/ / _, _/ / / / __  /        |
        |       \____/\____/\____//____/ |__/|__/\____/_/ |_| /_/ /_/ /_/         |
        |                                                                         |
        |                                                                         |
        | The COGSWORTHv1.1 build script contains some useful tasks for working   |
        | with BEAST.                                                             |
        |                                                                         |
        | Usage                                                                   |
        | -----                                                                   |
        |                                                                         |
        | To run the MCMC analysis in demo.xml                                    |
        |                                                                         |
        | $ ant -DbeastXML=demo.xml mcmc                                          |
        |                                                                         |
        | There are some targets to fetch JAR files, for example                  |
        |                                                                         |
        | $ ant get-beast2.6.7                                                    |
        |                                                                         |
        | To start tracer there is                                                |
        |                                                                         |
        | $ ant tracer                                                            |
        |                                                                         |
        | To print this help message and get a full list of available tasks       |
        |                                                                         |
        | $ ant -p                                                                |
        |                                                                         |
        | Libraries                                                               |
        | ---------                                                               |
        |                                                                         |
        | This script assumes there is a directory called lib containing some of  |
        | the following JAR files:                                                |
        |                                                                         |
        | - beast.jar from https://github.com/CompEvol/beast2/releases            |
        | - DensiTree.v2.2.7.jar from                                             |
        |   https://www.cs.auckland.ac.nz/~remco/DensiTree/                       |
        | - figtree.jar from https://github.com/rambaut/figtree/releases          |
        | - tracer.jar from https://github.com/beast-dev/tracer/releases          |
        |                                                                         |
        | there are some functions to assist in downloading these JAR files such  |
        | as get-beast2.6.7. You only need the JAR files for the programs that    |
        | you want to run. The ant manual may be helpful for understanding and    |
        | extending this script                                                   |
        |                                                                         |
        | - https://ant.apache.org/manual/index.html                              |
        |                                                                         |
        |_________________________________________________________________________|
    </description>
  <path id="classpath">
    <fileset dir="lib" includes="**/*.jar"/>
  </path>
  <target name="beauti">
    <java fork="true" classname="beast.app.beauti.Beauti">
      <classpath>
        <path refid="classpath"/>
      </classpath>
    </java>
  </target>
  <target name="master">
      <echo>Running the MASTER simulation defined in ${beastXML}</echo>
      <java fork="true" classname="beast.app.beastapp.BeastMain">
          <classpath>
              <path refid="classpath"/>
          </classpath>
          <arg line="-seed 1"/>
          <arg path="${beastXML}"/>
      </java>
  </target>
  <target name="mcmc">
    <echo>Running the MCMC sampler defined in ${beastXML}</echo>
    <java fork="true" classname="beast.app.beastapp.BeastMain">
      <classpath>
        <path refid="classpath"/>
      </classpath>
      <arg line="-seed 1"/>
      <arg path="${beastXML}"/>
    </java>
  </target>
  <target name="mcmc-keep-going">
    <java fork="true" classname="beast.app.beastapp.BeastMain">
      <classpath>
        <path refid="classpath"/>
      </classpath>
      <arg line="-seed 1 -resume"/>
      <arg path="${beastXML}"/>
    </java>
  </target>
  <target name="figtree">
    <java fork="true" jar="lib/figtree.jar">
        </java>
  </target>
  <target name="densitree">
    <java fork="true" jar="lib/DensiTree.v2.2.7.jar">
        </java>
  </target>
  <target name="tracer">
    <java fork="true" jar="lib/tracer.jar">
        </java>
  </target>

  <target name="clean">
      <delete file="fake.txt" />
  </target>
#+end_src

The following target demonstrates how we can partially automate the set up by
including targets that get the desired JAR files. When there are more of these
they could be lumped into useful combinations.

#+name: target:get-beast2.6.7
#+begin_src xml :tangle cogsworth.xml
  <target name="get-beast2.6.7">
      <mkdir dir="lib" />
      <get src="https://github.com/CompEvol/beast2/releases/download/v2.6.7/beast.jar" dest="lib/beast.jar" verbose="on" />
  </target>
#+end_src

While the [[target:get-beast2.6.7][get-beast2.6.7]] target helps get a JAR file to use in the analysis, to
compile a new package we will need the BEAST2 source. The following target
clones a copy of this. Note that if you want a particular version, you will need
to check that version out yourself!

#+begin_src xml :tangle cogsworth.xml
  <target name="clone-beast2">
      <exec executable="/usr/bin/git">
          <arg value="clone" />
          <arg value="--depth" />
          <arg value="1" />
          <arg value="https://github.com/CompEvol/beast2.git" />
          <arg value="beast2" />
      </exec>
      <echo>
          You may want to run `git fetch --all --tags`
      </echo>
  </target>
#+end_src

#+begin_src xml :tangle cogsworth.xml
</project>
#+end_src
